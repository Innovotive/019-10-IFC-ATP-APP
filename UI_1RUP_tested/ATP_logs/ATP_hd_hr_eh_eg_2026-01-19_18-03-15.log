[18:03:15] [INIT] ID pins configured (ACTIVE-HIGH, ID3 OFF)
[18:03:15] === ATP START — IDs: {1: 'hd', 2: 'hr', 3: 'eh', 4: 'eg'} ===
[18:03:15] [FILE] Log created: ATP_logs/ATP_hd_hr_eh_eg_2026-01-19_18-03-15.log
[18:03:15] [UI] Setup COMPLETE — Quick Test enabled
[18:03:17] [UI] Quick Test START
[18:03:17] [HW] relay_on()
[18:03:17] [GATE 1] REAL (RUP1)
[18:03:18] [GATE 2] REAL (RUP1)
[18:03:21] [UI] Quick Test COMPLETE
[18:03:36] [UI] Full ATP START
[18:03:37] [GATE 3] SIMULATED (depends on Gate 2)
[18:03:38] ============================================================
[18:03:38] [GATE4] Termination test (peak-based via can_commands)
[18:03:38] [GATE4] settle=2.5s window=3.0s fs=500Hz thresh=2.8V topN=20
[18:03:38] [GATE4] PASS needs OFF>ON: dvmax≥0.12V and dtopMean≥0.08V
[18:03:38] [GATE4] SPI + GPIO initialized
[18:03:38] [GATE4] → Sending TERMINATION_ON
[18:03:38] [GATE4] Waiting 2.5s before measuring ON...
[18:03:40] [GATE4] Measuring ON window...
[18:03:43] [GATE4] ON : vmax=2.532V, top20_mean=None, above=0 (0.0%)
[18:03:43] [GATE4] → Sending TERMINATION_OFF
[18:03:43] [GATE4] Waiting 2.5s before measuring OFF...
[18:03:46] [GATE4] Measuring OFF window...
[18:03:49] [GATE4] OFF: vmax=2.537V, top20_mean=None, above=0 (0.0%)
[18:03:49] [GATE4][FAIL] Not enough 'high' samples to compute top-mean. Lower HIGH_THRESH_V (2.7–2.9) or ensure bus traffic exists.
[18:03:49] [GATE4] SPI + GPIO released
[18:03:49] ==================================================
[18:03:49] [GATE5] Starting IUL (Indicator Light) test
[18:03:49] [GATE5] Expectations:
[18:03:49]         IUL_ON  → GPIO LOW  (LED ON)
[18:03:49]         IUL_OFF → GPIO HIGH (LED OFF)
[18:03:49] [GATE5] GPIO18 configured as INPUT
[18:03:49] [GATE5] → Sending IUL_ON (0xE1)
[18:03:49] [GATE5] Waiting 4s for LED to settle
[18:03:53] [GATE5] GPIO read 1: 0
[18:03:57] [GATE5] GPIO read 2: 0
[18:04:01] [GATE5] GPIO read 3: 0
[18:04:05] [GATE5] GPIO read 4: 0
[18:04:09] [GATE5] IUL_ON PASS (GPIO LOW)
[18:04:09] [GATE5] → Sending IUL_OFF (0xE0)
[18:04:09] [GATE5] Waiting 4s for LED to settle
[18:04:13] [GATE5] GPIO read 1: 1
[18:04:17] [GATE5] GPIO read 2: 1
[18:04:21] [GATE5] GPIO read 3: 1
[18:04:25] [GATE5] GPIO read 4: 1
[18:04:29] [GATE5] IUL_OFF PASS (GPIO HIGH)
[18:04:29] [GATE5] PASS — IUL functional test OK
[18:04:29] [GATE5] Cleaning up GPIO
[18:04:29] ==================================================
[18:04:33] [GATE7] Starting Gate 7 power check
[18:04:33] [GATE7] PM125 connected
[18:04:33] [GATE7] PM125 clean start: set 5V and 0mA
[18:04:35] [GATE7] RUP: sending POWER_TO_60W (once at start)
[18:04:37] --------------------------------------------------
[18:04:37] [GATE7] STEP 60W | desired 20.0V | target 60W
[18:04:37] [GATE7] PM125: negotiating voltage...
[18:04:39]    try idx=4 -> CONSTAT voltage=5000 mV
[18:04:42]    try idx=3 -> CONSTAT voltage=5000 mV
[18:04:44]    try idx=2 -> CONSTAT voltage=5000 mV
[18:04:46]    try idx=1 -> CONSTAT voltage=5000 mV
[18:04:48]    try idx=0 -> CONSTAT voltage=5000 mV
[18:04:48] [GATE7] FINAL CONSTAT: {'port_status': 1, 'profile_index': 0, 'profile': 5, 'profile_subtype': 0, 'voltage_mv': 5000, 'max_current_ma': 3000, 'max_power_mw': 15000}
[18:04:48] [GATE7][FAIL] Could not negotiate 20.0V
[18:04:48] [GATE7] Gate7 pass=False (RUP1 real, RUP2-4 simulated)
[18:04:48] [GATE7] Starting Gate 7 power check
[18:04:48] [GATE7] PM125 connected
[18:04:48] [GATE7] PM125 clean start: set 5V and 0mA
[18:04:48] [GATE7] RUP: sending POWER_TO_60W (once at start)
[18:04:48] --------------------------------------------------
[18:04:48] [GATE7] STEP 60W | desired 20.0V | target 60W
[18:04:48] [GATE7] PM125: negotiating voltage...
[18:04:48]    try idx=4 -> CONSTAT voltage=5000 mV
[18:04:48]    try idx=3 -> CONSTAT voltage=5000 mV
[18:04:48]    try idx=2 -> CONSTAT voltage=5000 mV
[18:04:48]    try idx=1 -> CONSTAT voltage=5000 mV
[18:04:48]    try idx=0 -> CONSTAT voltage=5000 mV
[18:04:48] [GATE7] FINAL CONSTAT: {'port_status': 1, 'profile_index': 0, 'profile': 5, 'profile_subtype': 0, 'voltage_mv': 5000, 'max_current_ma': 3000, 'max_power_mw': 15000}
[18:04:48] [GATE7][FAIL] Could not negotiate 20.0V
[18:04:48] [UI] Full ATP COMPLETE
[18:04:48] [HW] Shutdown: Full ATP complete
[18:04:48] [HW] END_ATP sent
[18:04:48] [HW] relay_off()
[18:04:48] [FILE] Excel written: ATP_logs/ATP_hd_hr_eh_eg_2026-01-19_18-03-15.xlsx
[18:04:48] === ATP END ===
