[17:20:36] [INIT] ID pins configured (ACTIVE-HIGH, ID3 OFF)
[17:20:36] === ATP START — IDs: {1: 'aergt', 2: 'reg', 3: 'er', 4: 're'} ===
[17:20:36] [FILE] Log created: ATP_logs/ATP_aergt_reg_er_re_2026-01-19_17-20-36.log
[17:20:36] [UI] Setup COMPLETE — Quick Test enabled
[17:20:37] [UI] Quick Test START
[17:20:37] [HW] relay_on()
[17:20:38] [GATE 1] REAL (RUP1)
[17:20:38] [GATE 2] REAL (RUP1)
[17:20:41] [UI] Quick Test COMPLETE
[17:20:46] [UI] Full ATP START
[17:20:47] [GATE 3] SIMULATED (depends on Gate 2)
[17:20:48] ============================================================
[17:20:48] [GATE4] Termination test (peak-based via can_commands)
[17:20:48] [GATE4] settle=2.5s window=3.0s fs=500Hz thresh=2.8V topN=20
[17:20:48] [GATE4] PASS needs OFF>ON: dvmax≥0.12V and dtopMean≥0.08V
[17:20:48] [GATE4] SPI + GPIO initialized
[17:20:48] [GATE4] → Sending TERMINATION_ON
[17:20:48] [GATE4] Waiting 2.5s before measuring ON...
[17:20:50] [GATE4] Measuring ON window...
[17:20:53] [GATE4] ON : vmax=3.656V, top20_mean=3.647605083088954, above=526 (35.1%)
[17:20:53] [GATE4] → Sending TERMINATION_OFF
[17:20:53] [GATE4] Waiting 2.5s before measuring OFF...
[17:20:56] [GATE4] Measuring OFF window...
[17:20:59] [GATE4] OFF: vmax=3.651V, top20_mean=3.644183773216031, above=276 (18.4%)
[17:20:59] [GATE4] Δ metrics: dvmax=-0.005V, dtopMean=-0.003V
[17:20:59] [GATE4][FAIL] OFF-ON vmax delta too small
[17:20:59] [GATE4] SPI + GPIO released
[17:20:59] ==================================================
[17:20:59] [GATE5] Starting IUL (Indicator Light) test
[17:20:59] [GATE5] Expectations:
[17:20:59]         IUL_ON  → GPIO LOW  (LED ON)
[17:20:59]         IUL_OFF → GPIO HIGH (LED OFF)
[17:20:59] [GATE5] GPIO18 configured as INPUT
[17:20:59] [GATE5] → Sending IUL_ON (0xE1)
[17:20:59] [GATE5] Waiting 4s for LED to settle
[17:21:03] [GATE5] GPIO read 1: 0
[17:21:07] [GATE5] GPIO read 2: 0
[17:21:11] [GATE5] GPIO read 3: 0
[17:21:15] [GATE5] GPIO read 4: 0
[17:21:19] [GATE5] IUL_ON PASS (GPIO LOW)
[17:21:19] [GATE5] → Sending IUL_OFF (0xE0)
[17:21:19] [GATE5] Waiting 4s for LED to settle
[17:21:23] [GATE5] GPIO read 1: 1
[17:21:27] [GATE5] GPIO read 2: 1
[17:21:31] [GATE5] GPIO read 3: 1
[17:21:35] [GATE5] GPIO read 4: 1
[17:21:39] [GATE5] IUL_OFF PASS (GPIO HIGH)
[17:21:39] [GATE5] PASS — IUL functional test OK
[17:21:39] [GATE5] Cleaning up GPIO
[17:21:39] ==================================================
[17:21:42] [GATE7] Starting Gate 7 power check
[17:21:42] [GATE7] PM125 connected
[17:21:42] [GATE7] PM125 clean start: set 5V and 0mA
[17:21:45] [GATE7] RUP: sending POWER_TO_60W (once at start)
[17:21:47] --------------------------------------------------
[17:21:47] [GATE7] STEP 60W | desired 20.0V | target 60W
[17:21:47] [GATE7] PM125: negotiating voltage...
[17:21:49]    try idx=4 -> CONSTAT voltage=20000 mV
[17:21:49] [GATE7] FINAL CONSTAT: {'port_status': 1, 'profile_index': 4, 'profile': 5, 'profile_subtype': 0, 'voltage_mv': 20000, 'max_current_ma': 2990, 'max_power_mw': 59800}
[17:21:49] [GATE7] Clamp: target 3000 mA > max 2990 mA
[17:21:49] [GATE7] PM125: ramp current to 2990 mA
[17:21:50]    ↳ set_current(250 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 20375, 'set_current_ma': 250, 'current_ma': 252, 'loopback_current_ma': 0}
[17:21:51]    ↳ set_current(500 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 20246, 'set_current_ma': 500, 'current_ma': 500, 'loopback_current_ma': 0}
[17:21:52]    ↳ set_current(750 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 20117, 'set_current_ma': 750, 'current_ma': 750, 'loopback_current_ma': 0}
[17:21:53]    ↳ set_current(1000 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19963, 'set_current_ma': 1000, 'current_ma': 1001, 'loopback_current_ma': 0}
[17:21:54]    ↳ set_current(1250 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19828, 'set_current_ma': 1250, 'current_ma': 1250, 'loopback_current_ma': 0}
[17:21:55]    ↳ set_current(1500 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19693, 'set_current_ma': 1500, 'current_ma': 1502, 'loopback_current_ma': 0}
[17:21:56]    ↳ set_current(1750 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19528, 'set_current_ma': 1750, 'current_ma': 1750, 'loopback_current_ma': 0}
[17:21:57]    ↳ set_current(2000 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19411, 'set_current_ma': 2000, 'current_ma': 2001, 'loopback_current_ma': 0}
[17:21:58]    ↳ set_current(2250 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19258, 'set_current_ma': 2250, 'current_ma': 2251, 'loopback_current_ma': 0}
[17:21:59]    ↳ set_current(2500 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19117, 'set_current_ma': 2500, 'current_ma': 2499, 'loopback_current_ma': 0}
[17:22:00]    ↳ set_current(2750 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 18957, 'set_current_ma': 2750, 'current_ma': 2748, 'loopback_current_ma': 0}
[17:22:01]    ↳ set_current(2990 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 18816, 'set_current_ma': 2990, 'current_ma': 2990, 'loopback_current_ma': 0}
[17:22:02] … PM125: 18.83 V, 2.989 A => 56.28 W (target 60 W)
[17:22:02] [GATE7] PM PASS — 56.28W in [42.00,78.00]
[17:22:02] [GATE7] RUP: POWER_REPORT_REQUEST (0xA2)
[17:22:02] [GATE7] RUP reports 58W (raw0=0xBD, data=['0xBD', '0x00', '0x00', '0x00', '0x00', '0x00', '0x00', '0x00'])
[17:22:02] [GATE7] RUP PASS — 58W in [42.0,78.0] for TARGET 60W
[17:22:02] [GATE7] Reset PM125 current to 0 mA
[17:22:04] --------------------------------------------------
[17:22:04] [GATE7] STEP 45W | desired 15.0V | target 45W
[17:22:04] [GATE7] PM125: negotiating voltage...
[17:22:06]    try idx=4 -> CONSTAT voltage=20000 mV
[17:22:08]    try idx=3 -> CONSTAT voltage=15000 mV
[17:22:08] [GATE7] FINAL CONSTAT: {'port_status': 1, 'profile_index': 3, 'profile': 5, 'profile_subtype': 0, 'voltage_mv': 15000, 'max_current_ma': 3000, 'max_power_mw': 45000}
[17:22:08] [GATE7] PM125: ramp current to 3000 mA
[17:22:09]    ↳ set_current(250 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 15344, 'set_current_ma': 250, 'current_ma': 251, 'loopback_current_ma': 0}
[17:22:10]    ↳ set_current(500 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 15196, 'set_current_ma': 500, 'current_ma': 504, 'loopback_current_ma': 0}
[17:22:12]    ↳ set_current(750 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 15049, 'set_current_ma': 750, 'current_ma': 746, 'loopback_current_ma': 0}
[17:22:13]    ↳ set_current(1000 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14902, 'set_current_ma': 1000, 'current_ma': 1001, 'loopback_current_ma': 0}
[17:22:14]    ↳ set_current(1250 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14767, 'set_current_ma': 1250, 'current_ma': 1252, 'loopback_current_ma': 0}
[17:22:15]    ↳ set_current(1500 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14632, 'set_current_ma': 1500, 'current_ma': 1501, 'loopback_current_ma': 0}
[17:22:16]    ↳ set_current(1750 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14497, 'set_current_ma': 1750, 'current_ma': 1754, 'loopback_current_ma': 0}
[17:22:17]    ↳ set_current(2000 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14337, 'set_current_ma': 2000, 'current_ma': 2000, 'loopback_current_ma': 0}
[17:22:18]    ↳ set_current(2250 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14196, 'set_current_ma': 2250, 'current_ma': 2247, 'loopback_current_ma': 0}
[17:22:19]    ↳ set_current(2500 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14049, 'set_current_ma': 2500, 'current_ma': 2496, 'loopback_current_ma': 0}
[17:22:20]    ↳ set_current(2750 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 13908, 'set_current_ma': 2750, 'current_ma': 2751, 'loopback_current_ma': 0}
[17:22:21]    ↳ set_current(3000 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 13748, 'set_current_ma': 3000, 'current_ma': 3002, 'loopback_current_ma': 0}
[17:22:21] … PM125: 13.77 V, 2.998 A => 41.27 W (target 45 W)
[17:22:21] [GATE7] PM PASS — 41.27W in [31.50,58.50]
[17:22:21] [GATE7] RUP: POWER_REPORT_REQUEST (0xA2)
[17:22:23] [GATE7][FAIL] No / invalid POWER_REPORT from RUP
[17:22:23] [GATE7] Gate7 pass=False (RUP1 real, RUP2-4 simulated)
[17:22:23] [GATE7] Starting Gate 7 power check
[17:22:23] [GATE7] PM125 connected
[17:22:23] [GATE7] PM125 clean start: set 5V and 0mA
[17:22:23] [GATE7] RUP: sending POWER_TO_60W (once at start)
[17:22:23] --------------------------------------------------
[17:22:23] [GATE7] STEP 60W | desired 20.0V | target 60W
[17:22:23] [GATE7] PM125: negotiating voltage...
[17:22:23]    try idx=4 -> CONSTAT voltage=20000 mV
[17:22:23] [GATE7] FINAL CONSTAT: {'port_status': 1, 'profile_index': 4, 'profile': 5, 'profile_subtype': 0, 'voltage_mv': 20000, 'max_current_ma': 2990, 'max_power_mw': 59800}
[17:22:23] [GATE7] Clamp: target 3000 mA > max 2990 mA
[17:22:23] [GATE7] PM125: ramp current to 2990 mA
[17:22:23]    ↳ set_current(250 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 20375, 'set_current_ma': 250, 'current_ma': 252, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(500 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 20246, 'set_current_ma': 500, 'current_ma': 500, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(750 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 20117, 'set_current_ma': 750, 'current_ma': 750, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1000 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19963, 'set_current_ma': 1000, 'current_ma': 1001, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1250 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19828, 'set_current_ma': 1250, 'current_ma': 1250, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1500 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19693, 'set_current_ma': 1500, 'current_ma': 1502, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1750 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19528, 'set_current_ma': 1750, 'current_ma': 1750, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2000 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19411, 'set_current_ma': 2000, 'current_ma': 2001, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2250 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19258, 'set_current_ma': 2250, 'current_ma': 2251, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2500 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 19117, 'set_current_ma': 2500, 'current_ma': 2499, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2750 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 18957, 'set_current_ma': 2750, 'current_ma': 2748, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2990 mA) | STAT: {'status': 0, 'temperature_c': 27, 'voltage_mv': 18816, 'set_current_ma': 2990, 'current_ma': 2990, 'loopback_current_ma': 0}
[17:22:23] … PM125: 18.83 V, 2.989 A => 56.28 W (target 60 W)
[17:22:23] [GATE7] PM PASS — 56.28W in [42.00,78.00]
[17:22:23] [GATE7] RUP: POWER_REPORT_REQUEST (0xA2)
[17:22:23] [GATE7] RUP reports 58W (raw0=0xBD, data=['0xBD', '0x00', '0x00', '0x00', '0x00', '0x00', '0x00', '0x00'])
[17:22:23] [GATE7] RUP PASS — 58W in [42.0,78.0] for TARGET 60W
[17:22:23] [GATE7] Reset PM125 current to 0 mA
[17:22:23] --------------------------------------------------
[17:22:23] [GATE7] STEP 45W | desired 15.0V | target 45W
[17:22:23] [GATE7] PM125: negotiating voltage...
[17:22:23]    try idx=4 -> CONSTAT voltage=20000 mV
[17:22:23]    try idx=3 -> CONSTAT voltage=15000 mV
[17:22:23] [GATE7] FINAL CONSTAT: {'port_status': 1, 'profile_index': 3, 'profile': 5, 'profile_subtype': 0, 'voltage_mv': 15000, 'max_current_ma': 3000, 'max_power_mw': 45000}
[17:22:23] [GATE7] PM125: ramp current to 3000 mA
[17:22:23]    ↳ set_current(250 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 15344, 'set_current_ma': 250, 'current_ma': 251, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(500 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 15196, 'set_current_ma': 500, 'current_ma': 504, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(750 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 15049, 'set_current_ma': 750, 'current_ma': 746, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1000 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14902, 'set_current_ma': 1000, 'current_ma': 1001, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1250 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14767, 'set_current_ma': 1250, 'current_ma': 1252, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1500 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14632, 'set_current_ma': 1500, 'current_ma': 1501, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(1750 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14497, 'set_current_ma': 1750, 'current_ma': 1754, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2000 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14337, 'set_current_ma': 2000, 'current_ma': 2000, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2250 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14196, 'set_current_ma': 2250, 'current_ma': 2247, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2500 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 14049, 'set_current_ma': 2500, 'current_ma': 2496, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(2750 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 13908, 'set_current_ma': 2750, 'current_ma': 2751, 'loopback_current_ma': 0}
[17:22:23]    ↳ set_current(3000 mA) | STAT: {'status': 0, 'temperature_c': 28, 'voltage_mv': 13748, 'set_current_ma': 3000, 'current_ma': 3002, 'loopback_current_ma': 0}
[17:22:23] … PM125: 13.77 V, 2.998 A => 41.27 W (target 45 W)
[17:22:23] [GATE7] PM PASS — 41.27W in [31.50,58.50]
[17:22:23] [GATE7] RUP: POWER_REPORT_REQUEST (0xA2)
[17:22:23] [GATE7][FAIL] No / invalid POWER_REPORT from RUP
[17:22:23] [UI] Full ATP COMPLETE
[17:22:23] [HW] Shutdown: Full ATP complete
[17:22:23] [HW] END_ATP sent
[17:22:23] [HW] relay_off()
[17:22:23] [FILE] Excel written: ATP_logs/ATP_aergt_reg_er_re_2026-01-19_17-20-36.xlsx
[17:22:23] === ATP END ===
