[11:52:42] [INIT] ID pins configured (ACTIVE-HIGH, ID3 OFF)
[11:52:42] === ATP START — IDs: {1: 'dgfr', 2: 'grfdz', 3: 'dgrf', 4: 'gd'} ===
[11:52:42] [FILE] Log created: ATP_logs/ATP_dgfr_grfdz_dgrf_gd_2026-01-16_11-52-42.log
[11:52:42] [UI] Setup COMPLETE — Quick Test enabled
[11:52:43] [UI] Quick Test START
[11:52:43] [HW] relay_on()
[11:52:44] [GATE 1] REAL (RUP1)
[11:52:44] [GATE 2] REAL (RUP1)
[11:52:47] [UI] Quick Test COMPLETE
[11:52:50] [UI] Full ATP START
[11:52:51] [GATE 3] SIMULATED (depends on Gate 2)
[11:52:52] ============================================================
[11:52:52] [GATE4] Termination test (peak-based via can_commands)
[11:52:52] [GATE4] settle=2.5s window=3.0s fs=500Hz thresh=2.8V topN=20
[11:52:52] [GATE4] PASS needs OFF>ON: dvmax≥0.12V and dtopMean≥0.08V
[11:52:52] [GATE4] SPI + GPIO initialized
[11:52:52] [GATE4] → Sending TERMINATION_ON
[11:52:52] [GATE4] Waiting 2.5s before measuring ON...
[11:52:54] [GATE4] Measuring ON window...
[11:52:57] [GATE4] ON : vmax=3.656V, top20_mean=3.6515151515151514, above=515 (34.3%)
[11:52:57] [GATE4] → Sending TERMINATION_OFF
[11:52:57] [GATE4] Waiting 2.5s before measuring OFF...
[11:53:00] [GATE4] Measuring OFF window...
[11:53:03] [GATE4] OFF: vmax=3.876V, top20_mean=3.8714565004887587, above=544 (36.3%)
[11:53:03] [GATE4] Δ metrics: dvmax=0.220V, dtopMean=0.220V
[11:53:03] [GATE4] PASS — termination change detected
[11:53:03] [GATE4] SPI + GPIO released
[11:53:03] ==================================================
[11:53:03] [GATE5] Starting IUL (Indicator Light) test
[11:53:03] [GATE5] Expectations:
[11:53:03]         IUL_ON  → GPIO LOW  (LED ON)
[11:53:03]         IUL_OFF → GPIO HIGH (LED OFF)
[11:53:03] [GATE5] GPIO25 configured as INPUT
[11:53:03] [GATE5] → Sending IUL_ON (0xE1)
[11:53:03] [GATE5] Waiting 4s for LED to settle
[11:53:07] [GATE5] GPIO read 1: 1
[11:53:11] [GATE5] GPIO read 2: 1
[11:53:15] [GATE5] GPIO read 3: 1
[11:53:19] [GATE5] GPIO read 4: 1
[11:53:23] [GATE5][FAIL] IUL_ON but GPIO is not LOW
[11:53:23] [GATE5] Cleaning up GPIO
[11:53:23] ==================================================
[11:53:27] [GATE7] Starting Gate 7 power check
[11:53:27] [GATE7] PM125 connected
[11:53:27] [GATE7] PM125 clean start: set 5V and 0mA
[11:53:29] [GATE7] RUP: sending POWER_TO_60W (once at start)
[11:53:31] --------------------------------------------------
[11:53:31] [GATE7] STEP 60W | desired 20.0V | target 60W
[11:53:31] [GATE7] PM125: negotiating voltage...
[11:53:33]    try idx=4 -> CONSTAT voltage=0 mV
[11:53:35]    try idx=3 -> CONSTAT voltage=0 mV
[11:53:37]    try idx=2 -> CONSTAT voltage=0 mV
[11:53:39]    try idx=1 -> CONSTAT voltage=0 mV
[11:53:41]    try idx=0 -> CONSTAT voltage=0 mV
[11:53:41] [GATE7] FINAL CONSTAT: {'port_status': 0, 'profile_index': 0, 'profile': 0, 'profile_subtype': 0, 'voltage_mv': 0, 'max_current_ma': 0, 'max_power_mw': 0}
[11:53:41] [GATE7][FAIL] Could not negotiate 20.0V
[11:53:41] [GATE7] Gate7 pass=False (RUP1 real, RUP2-4 simulated)
[11:53:41] [GATE7] Starting Gate 7 power check
[11:53:41] [GATE7] PM125 connected
[11:53:41] [GATE7] PM125 clean start: set 5V and 0mA
[11:53:41] [GATE7] RUP: sending POWER_TO_60W (once at start)
[11:53:41] --------------------------------------------------
[11:53:41] [GATE7] STEP 60W | desired 20.0V | target 60W
[11:53:41] [GATE7] PM125: negotiating voltage...
[11:53:41]    try idx=4 -> CONSTAT voltage=0 mV
[11:53:41]    try idx=3 -> CONSTAT voltage=0 mV
[11:53:41]    try idx=2 -> CONSTAT voltage=0 mV
[11:53:41]    try idx=1 -> CONSTAT voltage=0 mV
[11:53:41]    try idx=0 -> CONSTAT voltage=0 mV
[11:53:41] [GATE7] FINAL CONSTAT: {'port_status': 0, 'profile_index': 0, 'profile': 0, 'profile_subtype': 0, 'voltage_mv': 0, 'max_current_ma': 0, 'max_power_mw': 0}
[11:53:41] [GATE7][FAIL] Could not negotiate 20.0V
[11:53:41] [UI] Full ATP COMPLETE
[11:53:41] [HW] Shutdown: Full ATP complete
[11:53:41] [HW] END_ATP sent
[11:53:41] [HW] relay_off()
[11:53:42] [FILE] Excel written: ATP_logs/ATP_dgfr_grfdz_dgrf_gd_2026-01-16_11-52-42.xlsx
[11:53:42] === ATP END ===
